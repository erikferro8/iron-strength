<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Iron Strength</title>
  <style>
    :root{
      --brand-50:#FFF5F5; --brand-100:#FEECEC; --brand-200:#FCD4D4; --brand-300:#F7A9A9;
      --brand-400:#E97878; --brand-500:#D65A5A; --brand-600:#C84E4E; --brand-700:#B04343;
      --text:#111827; --muted:#6b7280; --bg:#f4f4f5; --card:#ffffff; --border:rgba(0,0,0,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:linear-gradient(180deg,var(--brand-50),#fff);}
    a{color:inherit}
    .topbar{
      position:sticky; top:0; z-index:10;
      background: rgba(255,255,255,.92); backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      padding: 12px 16px;
      display:flex; align-items:center; justify-content:space-between;
      max-width: 430px; margin:0 auto;
    }
    .wrap{max-width:430px;margin:0 auto;padding:16px 16px 96px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:12px;padding:12px 14px;font-weight:800;font-size:14px;border:1px solid transparent;cursor:pointer;user-select:none}
    .btn-primary{background:var(--brand-500);color:#fff}
    .btn-primary:active{background:var(--brand-700)}
    .btn-ghost{background:rgba(0,0,0,.05);color:var(--text)}
    .btn-ghost:active{background:rgba(0,0,0,.10)}
    .row{display:flex;gap:10px}
    .wfull{width:100%}
    .label{font-size:12px;color:var(--muted);font-weight:800;letter-spacing:.04em}
    input,textarea{
      width:100%; border-radius:12px; border:1px solid var(--border);
      padding:10px 12px; font-size:14px; outline:none; background:#fff;
    }
    input:focus,textarea:focus{border-color:var(--brand-400); box-shadow: 0 0 0 4px rgba(214,90,90,.18);}
    .chip{display:inline-flex;align-items:center;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:800;border:1px solid var(--border)}
    .chip-guided{background:var(--brand-50);border-color:var(--brand-200);color:var(--brand-700)}
    .chip-optional{background:#fafafa;border-color:rgba(0,0,0,.10);color:#374151}
    .h1{font-size:28px;font-weight:900;letter-spacing:-.02em;margin:4px 0 0}
    .muted{color:var(--muted)}
    .mt8{margin-top:8px} .mt12{margin-top:12px} .mt16{margin-top:16px}
    .calendarItem{width:100%;text-align:left;padding:14px 14px;border-radius:16px;border:1px solid var(--border);background:#fff;box-shadow:var(--shadow);cursor:pointer}
    .calendarItem.sel{outline: none; box-shadow: 0 0 0 4px rgba(214,90,90,.18), var(--shadow); border-color: var(--brand-300);}
    .calgrid{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .datebox{width:52px;text-align:center}
    .dow{font-size:12px;color:var(--muted);font-weight:800}
    .dom{font-size:14px;font-weight:900}
    .title{font-weight:900}
    .sub{font-size:12px;color:var(--muted);margin-top:4px}
    .setrow{display:grid;grid-template-columns:64px 1fr 1fr;gap:10px;align-items:center;margin-top:10px}
    .setlbl{font-size:12px;color:var(--muted);font-weight:800}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111827;color:#fff;padding:10px 12px;border-radius:12px;font-size:13px;opacity:0;transition:opacity .2s}
    .toast.show{opacity:1}
    .small{font-size:12px}
  </style>
</head>
<body>
  <div id="app"></div>
  <div id="toast" class="toast"></div>

<script>
const KEY="iron_strength_static_v1";
const nowISO=()=>new Date().toISOString();
const uid=(p="id")=>`${p}_${Math.random().toString(16).slice(2)}_${Date.now().toString(16)}`;
const fmtDay=(iso)=>new Date(iso+"T12:00:00").toLocaleDateString(undefined,{weekday:"short"});
const fmtDate=(iso)=>new Date(iso+"T12:00:00").toLocaleDateString(undefined,{month:"short",day:"numeric"});
const fmtLong=(iso)=>new Date(iso+"T12:00:00").toLocaleDateString(undefined,{weekday:"long",month:"short",day:"numeric"});

function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg; t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1800);
}

function seed(){
  const today=new Date();
  const ymd=(d)=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  const days=[0,1,2,3,4,5,6].map(i=>{const d=new Date(today); d.setDate(today.getDate()+i); return ymd(d);});
  const trainerId=uid("usr"), clientId=uid("usr");

  const wk1={id:uid("wko"),title:"Lower Body (Glutes + Quads)",type:"guided",durationMin:55,focusTags:["glutes","quads","core"],
    exercises:[
      {id:uid("ex"),name:"Leg Press",sets:4,reps:"10-12",restSec:90,notes:"Control the descent."},
      {id:uid("ex"),name:"Dumbbell RDL",sets:3,reps:"8-10",restSec:90,notes:"Hips back, neutral spine."},
      {id:uid("ex"),name:"Hip Thrust (Machine/Bar)",sets:4,reps:"8-12",restSec:90,notes:"Pause at the top 1 sec."},
      {id:uid("ex"),name:"Cable Abduction",sets:3,reps:"12-15",restSec:60,notes:"Upper-glute focus."},
      {id:uid("ex"),name:"Dead Bug",sets:3,reps:"8/side",restSec:45}
    ]};
  const wk2={id:uid("wko"),title:"Upper Body (Push + Pull)",type:"guided",durationMin:55,focusTags:["back","chest","shoulders"],
    exercises:[
      {id:uid("ex"),name:"Lat Pulldown",sets:4,reps:"8-12",restSec:75},
      {id:uid("ex"),name:"Incline DB Press",sets:4,reps:"8-12",restSec:90},
      {id:uid("ex"),name:"Seated Cable Row",sets:3,reps:"10-12",restSec:75},
      {id:uid("ex"),name:"DB Lateral Raise",sets:3,reps:"12-15",restSec:60},
      {id:uid("ex"),name:"Plank",sets:3,reps:"30-45s",restSec:45}
    ]};
  const wk3={id:uid("wko"),title:"Optional Conditioning (Zone 2 + Core)",type:"optional",durationMin:35,focusTags:["cardio","core"],
    exercises:[
      {id:uid("ex"),name:"Treadmill Incline Walk",sets:1,reps:"25 min",restSec:0,notes:"RPE 6/10 steady."},
      {id:uid("ex"),name:"Hanging Knee Raise",sets:3,reps:"8-12",restSec:60},
      {id:uid("ex"),name:"Side Plank",sets:2,reps:"30s/side",restSec:45}
    ]};
  const programId=uid("prg");
  const daysMap=[
    {dateISO:days[0],workoutId:wk1.id},{dateISO:days[1],workoutId:wk2.id},{dateISO:days[2],workoutId:wk3.id},
    {dateISO:days[3],workoutId:wk1.id},{dateISO:days[4],workoutId:wk2.id},{dateISO:days[5],workoutId:wk3.id},{dateISO:days[6],workoutId:wk1.id},
  ].map(d=>({id:uid("day"),...d}));

  return {
    users:[
      {id:trainerId,role:"trainer",name:"Coach Erik",email:"trainer@ironstrength.com",password:"trainer",createdAt:nowISO()},
      {id:clientId,role:"client",name:"Demo Client",email:"client@ironstrength.com",password:"client",createdAt:nowISO()}
    ],
    programs:[{id:programId,clientId,trainerId,name:"Iron Strength — Week 1",days:daysMap,workouts:[wk1,wk2,wk3],updatedAt:nowISO()}],
    logs:[],
    session:null
  };
}

function getDB(){
  const raw=localStorage.getItem(KEY);
  if(!raw){ const db=seed(); localStorage.setItem(KEY,JSON.stringify(db)); return db; }
  try{ return JSON.parse(raw); }catch(e){ const db=seed(); localStorage.setItem(KEY,JSON.stringify(db)); return db; }
}
function setDB(db){ localStorage.setItem(KEY,JSON.stringify(db)); }
function resetDB(){ localStorage.removeItem(KEY); }

function sessionUser(){
  const db=getDB();
  if(!db.session?.userId) return null;
  return db.users.find(u=>u.id===db.session.userId)||null;
}
function signIn(email,pw){
  const db=getDB();
  const u=db.users.find(x=>x.email.toLowerCase()===email.toLowerCase() && x.password===pw);
  if(!u) return {ok:false,error:"Invalid email or password."};
  db.session={userId:u.id}; setDB(db); return {ok:true,user:u};
}
function signOut(){ const db=getDB(); db.session=null; setDB(db); }
function programForClient(clientId){ const db=getDB(); return db.programs.find(p=>p.clientId===clientId)||null; }
function programsForTrainer(trainerId){ const db=getDB(); return db.programs.filter(p=>p.trainerId===trainerId); }
function logsForProgram(programId){ const db=getDB(); return db.logs.filter(l=>l.programId===programId); }
function saveLog(log){
  const db=getDB();
  const i=db.logs.findIndex(x=>x.id===log.id);
  if(i>=0) db.logs[i]=log; else db.logs.push(log);
  setDB(db);
}
function createClient(name,email){
  const db=getDB();
  const u={id:uid("usr"),role:"client",name,email,password:"client",createdAt:nowISO()};
  db.users.push(u); setDB(db); return u;
}
function upsertProgram(p){
  const db=getDB();
  const i=db.programs.findIndex(x=>x.id===p.id);
  if(i>=0) db.programs[i]=p; else db.programs.push(p);
  setDB(db);
}

function el(tag, attrs={}, children=[]){
  const n=document.createElement(tag);
  for(const [k,v] of Object.entries(attrs||{})){
    if(k==="class") n.className=v;
    else if(k==="html") n.innerHTML=v;
    else if(k.startsWith("on") && typeof v==="function") n.addEventListener(k.slice(2).toLowerCase(), v);
    else n.setAttribute(k,v);
  }
  (children||[]).forEach(c=> n.appendChild(typeof c==="string"?document.createTextNode(c):c));
  return n;
}

function topbar(title, rightNode){
  return el("div",{class:"topbar"},[
    el("div",{style:"font-weight:900;letter-spacing:-.01em"},[title]),
    rightNode||el("div",{},[])
  ]);
}

function route(){
  const hash=location.hash.replace("#","");
  const [path, qs] = hash.split("?");
  const params=new URLSearchParams(qs||"");
  return {path: path||"/", params};
}
function nav(to){ location.hash=to; }

function pageHome(){
  const body=el("div",{class:"wrap"},[
    el("div",{class:"card"},[
      el("div",{class:"label",style:"color:var(--brand-700)"},["IRON STRENGTH"]),
      el("div",{class:"h1"},["Trainer + Client Demo"]),
      el("div",{class:"mt8 muted",style:"font-size:14px"},["Everfit-style calendar + workouts. Runs 100% on your phone (no deploy, no accounts)."]),
      el("div",{class:"mt16"},[
        el("button",{class:"btn btn-primary wfull", onclick:()=>nav("/login")},["Open App"]),
        el("div",{class:"mt12"}),
        el("button",{class:"btn btn-ghost wfull", onclick:()=>nav("/about")},["What’s included"])
      ]),
      el("div",{class:"mt16",style:"border:1px solid var(--brand-200);background:var(--brand-50);border-radius:12px;padding:12px;font-size:12px;color:var(--brand-700)"},[
        el("div",{},["Demo logins:"]),
        el("div",{class:"mt8"},[
          el("div",{},["Trainer: trainer@ironstrength.com / trainer"]),
          el("div",{},["Client: client@ironstrength.com / client"])
        ])
      ])
    ]),
    el("div",{class:"mt16 muted small",style:"text-align:center"},["Tip: Add to Home Screen in Safari for an app-like feel."])
  ]);
  return el("div",{},[body]);
}

function pageAbout(){
  return el("div",{},[
    topbar("What’s included", el("button",{class:"btn btn-ghost", onclick:()=>nav("/login")},["Login"])),
    el("div",{class:"wrap"},[
      el("div",{class:"card"},[
        el("div",{style:"font-weight:900"},["Client view"]),
        el("ul",{style:"margin:10px 0 0; padding-left:18px; color:#374151; font-size:14px; line-height:1.5"},[
          el("li",{},["Everfit-style calendar list (guided + optional)"]),
          el("li",{},["Tap a day → workout details"]),
          el("li",{},["Log reps + weight per set"]),
          el("li",{},["History stays on device"])
        ])
      ]),
      el("div",{class:"mt12 card"},[
        el("div",{style:"font-weight:900"},["Trainer view"]),
        el("ul",{style:"margin:10px 0 0; padding-left:18px; color:#374151; font-size:14px; line-height:1.5"},[
          el("li",{},["See assigned programs"]),
          el("li",{},["Open a client program and view logs"]),
          el("li",{},["Reset demo data (for testing)"])
        ])
      ]),
      el("div",{class:"mt12 card"},[
        el("div",{style:"font-weight:900"},["Important"]),
        el("div",{class:"mt8",style:"font-size:14px;color:#374151;line-height:1.5"},[
          "This demo stores data in your phone’s browser (localStorage). Next step is connecting a real backend so trainers and clients sync across devices."
        ])
      ]),
      el("div",{class:"mt12"},[
        el("button",{class:"btn btn-primary wfull", onclick:()=>nav("/login")},["Go to Login"])
      ])
    ])
  ]);
}

function pageLogin(){
  const u=sessionUser();
  if(u) return (u.role==="trainer"?nav("/trainer"):nav("/client"));
  let email="client@ironstrength.com", pw="client";
  const errNode=el("div",{style:"color:#dc2626;font-size:14px;display:none"});
  const emailIn=el("input",{value:email, oninput:(e)=>email=e.target.value, placeholder:"you@example.com"});
  const pwIn=el("input",{value:pw, type:"password", oninput:(e)=>pw=e.target.value, placeholder:"••••••••"});
  const signin=()=>{
    const r=signIn(email,pw);
    if(!r.ok){ errNode.style.display="block"; errNode.textContent=r.error; return; }
    nav(r.user.role==="trainer"?"/trainer":"/client");
  };
  const reset=()=>{ resetDB(); getDB(); toast("Demo data reset"); };
  return el("div",{},[
    topbar("Login", el("button",{class:"btn btn-ghost", onclick:()=>nav("/")},["Home"])),
    el("div",{class:"wrap"},[
      el("div",{class:"card"},[
        el("div",{class:"label",style:"color:var(--brand-700)"},["IRON STRENGTH"]),
        el("div",{style:"font-size:20px;font-weight:900;margin-top:6px"},["Welcome back"]),
        el("div",{class:"mt16"},[
          el("div",{class:"label"},["Email"]),
          emailIn,
          el("div",{class:"mt12 label"},["Password"]),
          pwIn,
          el("div",{class:"mt12"},[errNode]),
          el("div",{class:"mt12"},[
            el("button",{class:"btn btn-primary wfull", onclick:signin},["Sign in"])
          ]),
          el("div",{class:"mt12",style:"border:1px solid var(--brand-200);background:var(--brand-50);border-radius:12px;padding:12px;font-size:12px;color:var(--brand-700)"},[
            el("div",{},["Demo logins:"]),
            el("div",{class:"mt8"},[
              el("div",{},["Trainer: trainer@ironstrength.com / trainer"]),
              el("div",{},["Client: client@ironstrength.com / client"])
            ])
          ]),
          el("div",{class:"mt12 row"},[
            el("button",{class:"btn btn-ghost wfull", onclick:reset},["Reset demo data"]),
            el("button",{class:"btn btn-ghost wfull", onclick:()=>nav("/about")},["About"])
          ])
        ])
      ])
    ])
  ]);
}

function pageClient(){
  const u=sessionUser();
  if(!u) return nav("/login");
  if(u.role!=="client") return nav("/trainer");
  const program=programForClient(u.id);
  if(!program){
    return el("div",{},[
      topbar("Client", el("button",{class:"btn btn-ghost", onclick:()=>nav("/login")},["Login"])),
      el("div",{class:"wrap"},[
        el("div",{class:"card"},[
          el("div",{style:"font-weight:900"},["No program assigned"]),
          el("div",{class:"mt8 muted",style:"font-size:14px"},["Log in with demo client, or assign a program as a trainer."])
        ])
      ])
    ]);
  }
  let selected=program.days[0]?.dateISO;
  const list=el("div",{class:"mt12"});
  const renderList=()=>{
    list.innerHTML="";
    program.days.forEach(d=>{
      const w=program.workouts.find(x=>x.id===d.workoutId);
      const btn=el("button",{class:"calendarItem"+(d.dateISO===selected?" sel":""), onclick:()=>{selected=d.dateISO; renderList();}},[
        el("div",{class:"calgrid"},[
          el("div",{style:"display:flex;align-items:center;gap:12px"},[
            el("div",{class:"datebox"},[
              el("div",{class:"dow"},[fmtDay(d.dateISO)]),
              el("div",{class:"dom"},[fmtDate(d.dateISO)])
            ]),
            el("div",{},[
              el("div",{class:"title"},[w.title]),
              el("div",{class:"sub"},[(w.focusTags||[]).join(" • ") || (w.durationMin+" min")])
            ])
          ]),
          el("div",{},[
            el("span",{class:"chip "+(w.type==="guided"?"chip-guided":"chip-optional")},[w.type==="guided"?"Guided":"Optional"])
          ])
        ])
      ]);
      list.appendChild(btn);
      list.appendChild(el("div",{style:"height:10px"}));
    });
  };
  const openWorkout=()=>{
    const day=program.days.find(x=>x.dateISO===selected);
    if(!day) return;
    nav(`/client/workout?date=${encodeURIComponent(day.dateISO)}&workout=${encodeURIComponent(day.workoutId)}&program=${encodeURIComponent(program.id)}`);
  };

  const right=el("button",{class:"btn btn-ghost", onclick:()=>{signOut(); nav("/login");}},["Sign out"]);
  const body=el("div",{class:"wrap"},[
    el("div",{class:"card"},[
      el("div",{class:"label"},["PROGRAM"]),
      el("div",{style:"font-weight:900;font-size:18px;margin-top:4px"},[program.name]),
      list,
      el("div",{class:"mt12"},[
        el("button",{class:"btn btn-primary wfull", onclick:openWorkout},["Open workout"])
      ])
    ]),
    el("div",{class:"mt12 muted small",style:"text-align:center"},["Tip: guided = main session, optional = extra credit."])
  ]);
  renderList();
  return el("div",{},[topbar("Your Schedule", right), body]);
}

function pageClientWorkout(params){
  const u=sessionUser();
  if(!u) return nav("/login");
  if(u.role!=="client") return nav("/trainer");
  const program=programForClient(u.id);
  const dateISO=params.get("date")||"";
  const workoutId=params.get("workout")||"";
  const w=program.workouts.find(x=>x.id===workoutId) || program.workouts[0];

  const existing=logsForProgram(program.id).find(l=>l.userId===u.id && l.workoutId===w.id && l.dateISO===dateISO);
  let log = existing || {
    id: uid("log"),
    userId: u.id,
    programId: program.id,
    workoutId: w.id,
    dateISO,
    completedAt: null,
    exercises: w.exercises.map(ex=>({
      exerciseId: ex.id,
      notes: "",
      sets: Array.from({length: ex.sets}).map((_,i)=>({setNumber:i+1, weight:"", reps:""}))
    }))
  };

  const right=el("button",{class:"btn btn-ghost", onclick:()=>nav("/client")},["Back"]);
  const body=el("div",{class:"wrap"},[
    el("div",{class:"card"},[
      el("div",{class:"label"},["DATE"]),
      el("div",{style:"font-weight:900"},[fmtLong(dateISO)]),
      el("div",{class:"mt12",style:"display:flex;align-items:center;gap:8px"},[
        el("div",{style:"font-weight:900;font-size:18px"},[w.title]),
        el("span",{class:"chip "+(w.type==="guided"?"chip-guided":"chip-optional")},[w.type==="guided"?"Guided":"Optional"])
      ]),
      el("div",{class:"mt8 muted",style:"font-size:14px"},[`${w.durationMin} min • ${(w.focusTags||[]).join(" • ")}`])
    ])
  ]);

  w.exercises.forEach(ex=>{
    const exLog=log.exercises.find(e=>e.exerciseId===ex.id);
    const card=el("div",{class:"mt12 card"},[
      el("div",{style:"font-weight:900"},[ex.name]),
      el("div",{class:"mt8 muted small"},[`${ex.sets} sets • ${ex.reps} reps • Rest ${ex.restSec}s`]),
      ex.notes? el("div",{class:"mt8 muted small"},[ex.notes]) : el("div",{},[])
    ]);
    exLog.sets.forEach(s=>{
      const weight=el("input",{value:s.weight, placeholder:"Weight", oninput:(e)=>{s.weight=e.target.value;}});
      const reps=el("input",{value:s.reps, placeholder:"Reps", oninput:(e)=>{s.reps=e.target.value;}});
      card.appendChild(el("div",{class:"setrow"},[
        el("div",{class:"setlbl"},[`Set ${s.setNumber}`]),
        weight,
        reps
      ]));
    });
    const notes=el("textarea",{rows:"2", placeholder:"How did it feel?", value: exLog.notes||"", oninput:(e)=>{exLog.notes=e.target.value;}});
    card.appendChild(el("div",{class:"mt12"},[
      el("div",{class:"label"},["Notes"]),
      notes
    ]));
    body.appendChild(card);
  });

  const saveBtn=el("button",{class:"btn btn-ghost wfull", onclick:()=>{saveLog(log); toast("Saved");}},["Save"]);
  const completeBtn=el("button",{class:"btn btn-primary wfull", onclick:()=>{log.completedAt=nowISO(); saveLog(log); toast("Completed"); nav("/client");}},["Complete"]);
  body.appendChild(el("div",{class:"mt12 row"},[saveBtn, completeBtn]));
  body.appendChild(el("div",{class:"mt12 muted small",style:"text-align:center"},["Saved locally on this device."]));
  return el("div",{},[topbar("Workout", right), body]);
}

function pageTrainer(){
  const u=sessionUser();
  if(!u) return nav("/login");
  if(u.role!=="trainer") return nav("/client");
  const right=el("button",{class:"btn btn-ghost", onclick:()=>{signOut(); nav("/login");}},["Sign out"]);
  const body=el("div",{class:"wrap"});
  let msgNode=el("div",{class:"mt12",style:"font-size:14px;color:var(--brand-700);display:none"});

  function refresh(){
    const ps=programsForTrainer(u.id);
    list.innerHTML="";
    if(ps.length===0){
      list.appendChild(el("div",{class:"muted",style:"font-size:14px"},["No programs yet."]));
      return;
    }
    ps.forEach(p=>{
      const btn=el("button",{class:"calendarItem", onclick:()=>nav(`/trainer/program?program=${encodeURIComponent(p.id)}`)},[
        el("div",{class:"title"},[p.name]),
        el("div",{class:"sub"},[`${p.days.length} scheduled days • Updated ${new Date(p.updatedAt).toLocaleString()}`])
      ]);
      list.appendChild(btn);
      list.appendChild(el("div",{style:"height:10px"}));
    });
  }

  function showMsg(t){ msgNode.style.display="block"; msgNode.textContent=t; }

  const quick=el("div",{class:"card"},[
    el("div",{style:"font-weight:900"},["Quick actions"]),
    el("div",{class:"mt12 row"},[
      el("button",{class:"btn btn-ghost wfull", onclick:()=>{resetDB(); getDB(); showMsg("Demo data reset."); refresh();}},["Reset demo"]),
      el("button",{class:"btn btn-ghost wfull", onclick:()=>nav("/")},["Home"])
    ]),
    msgNode
  ]);

  let clientName="New Client", clientEmail="newclient@ironstrength.com";
  const createCard=el("div",{class:"mt12 card"},[
    el("div",{style:"font-weight:900"},["Create a new client (demo)"]),
    el("div",{class:"mt12"},[
      el("div",{class:"label"},["Client name"]),
      el("input",{value:clientName, oninput:(e)=>clientName=e.target.value}),
      el("div",{class:"mt12 label"},["Client email"]),
      el("input",{value:clientEmail, oninput:(e)=>clientEmail=e.target.value}),
      el("div",{class:"mt12"},[
        el("button",{class:"btn btn-primary wfull", onclick:()=>{
          const c=createClient(clientName, clientEmail);
          const today=new Date();
          const ymd=(d)=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
          const workouts=[
            {id:uid("wko"),title:"Full Body A",type:"guided",durationMin:50,focusTags:["strength","full body"],
              exercises:[
                {id:uid("ex"),name:"Goblet Squat",sets:3,reps:"10-12",restSec:75},
                {id:uid("ex"),name:"DB Bench Press",sets:3,reps:"8-12",restSec:75},
                {id:uid("ex"),name:"Seated Row",sets:3,reps:"10-12",restSec:75},
                {id:uid("ex"),name:"Pallof Press",sets:3,reps:"10/side",restSec:45}
              ]},
            {id:uid("wko"),title:"Optional Cardio + Core",type:"optional",durationMin:30,focusTags:["cardio","core"],
              exercises:[
                {id:uid("ex"),name:"Bike (Zone 2)",sets:1,reps:"20 min",restSec:0},
                {id:uid("ex"),name:"Cable Crunch",sets:3,reps:"12-15",restSec:60}
              ]}
          ];
          const days=[0,1,2,3,4].map(i=>{const d=new Date(today); d.setDate(today.getDate()+i); const dateISO=ymd(d); const workoutId=i%2===0?workouts[0].id:workouts[1].id; return {id:uid("day"),dateISO,workoutId};});
          const program={id:uid("prg"),clientId:c.id,trainerId:u.id,name:`Starter Program — ${c.name}`,days,workouts,updatedAt:nowISO()};
          upsertProgram(program);
          showMsg(`Created client (${c.email}, password: client) and assigned a program.`);
          refresh();
        }},["Create + assign program"])
      ]),
      el("div",{class:"mt8 muted small"},["Password for new client will be client (demo only)."])
    ])
  ]);

  const list=el("div",{class:"mt12"});
  const programsCard=el("div",{class:"mt12 card"},[
    el("div",{style:"font-weight:900"},["Assigned programs"]),
    el("div",{class:"mt12"},[list])
  ]);

  body.appendChild(quick);
  body.appendChild(createCard);
  body.appendChild(programsCard);
  refresh();
  return el("div",{},[topbar("Trainer", right), body]);
}

function pageTrainerProgram(params){
  const u=sessionUser();
  if(!u) return nav("/login");
  if(u.role!=="trainer") return nav("/client");
  const programId=params.get("program")||"";
  const db=getDB();
  const p=db.programs.find(x=>x.id===programId);
  if(!p) return nav("/trainer");
  const client=db.users.find(x=>x.id===p.clientId);
  const logs=logsForProgram(p.id);

  const byDate=new Map();
  logs.forEach(l=>{
    if(!byDate.has(l.dateISO)) byDate.set(l.dateISO,[]);
    byDate.get(l.dateISO).push(l);
  });
  const dates=[...byDate.keys()].sort();

  const right=el("button",{class:"btn btn-ghost", onclick:()=>nav("/trainer")},["Back"]);
  const body=el("div",{class:"wrap"},[
    el("div",{class:"card"},[
      el("div",{class:"label"},["CLIENT"]),
      el("div",{style:"font-weight:900;font-size:18px"},[client?.name||"Client"]),
      el("div",{class:"muted",style:"font-size:14px"},[client?.email||""]),
      el("div",{class:"mt12 label"},["PROGRAM"]),
      el("div",{style:"font-weight:900"},[p.name]),
      el("div",{class:"mt8 muted small"},[`Scheduled days: ${p.days.length}`])
    ])
  ]);

  const logsWrap=el("div",{class:"mt12"});
  if(!dates.length){
    logsWrap.appendChild(el("div",{class:"card"},[
      el("div",{style:"font-weight:900"},["No logs yet"]),
      el("div",{class:"mt8 muted",style:"font-size:14px"},["Have the client complete a workout and come back here."])
    ]));
  }
  dates.forEach(date=>{
    const group=el("div",{class:"card",style:"padding:14px;margin-top:12px;background:#fff"},[
      el("div",{style:"font-weight:900"},[fmtLong(date)])
    ]);
    byDate.get(date).forEach(l=>{
      const w=p.workouts.find(x=>x.id===l.workoutId);
      const done=!!l.completedAt;
      const box=el("div",{style:"margin-top:12px;border:1px solid var(--border);border-radius:14px;padding:12px;background:#fff"},[
        el("div",{style:"display:flex;align-items:flex-start;justify-content:space-between;gap:10px"},[
          el("div",{},[
            el("div",{style:"font-weight:900"},[w?.title||"Workout"]),
            el("div",{class:"muted small"},[done?`Completed ${new Date(l.completedAt).toLocaleString()}`:"Saved (not completed)"])
          ]),
          el("span",{class:"chip "+(done?"chip-guided":"chip-optional")},[done?"Completed":"In progress"])
        ])
      ]);
      group.appendChild(box);
    });
    logsWrap.appendChild(group);
  });

  body.appendChild(logsWrap);
  return el("div",{},[topbar("Program", right), body]);
}

function render(){
  const {path, params}=route();
  const root=document.getElementById("app");
  root.innerHTML="";
  let node=null;
  if(path==="/") node=pageHome();
  else if(path==="/about") node=pageAbout();
  else if(path==="/login") node=pageLogin();
  else if(path==="/client") node=pageClient();
  else if(path==="/client/workout") node=pageClientWorkout(params);
  else if(path==="/trainer") node=pageTrainer();
  else if(path==="/trainer/program") node=pageTrainerProgram(params);
  else node=pageHome();
  root.appendChild(node);
}

window.addEventListener("hashchange", render);
getDB();
if(!location.hash) location.hash="#/";
render();
</script>
</body>
</html>
